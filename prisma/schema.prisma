generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Record {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  createdAt DateTime @default(now())
  files     File[]
}

model File {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  filename         String
  mimetype         String
  sizeBytes        Int
  path             String
  createdAt        DateTime @default(now())
  record           Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)
  recordId         String   @db.ObjectId
  extractionStatus String   @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  extractedData    String?  // JSON string of extracted data (removed @db.Text as it's not supported in MongoDB)
  extractionError  String?
}

model Product {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  sku               String   @unique
  name              String
  brand             String?
  group             String?
  description       String?
  price             Float?   // Selling price
  cost              Float?    // Cost price
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  stocks            Stock[]
  orderItems        OrderItem[]
  stockTransactions StockTransaction[]
  minStockThreshold Int      @default(10) // Default minimum stock threshold
  @@index([name])
  @@index([brand])
  @@index([group])
}

model Stock {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String   @db.ObjectId
  location  String   @default("TOTAL")
  quantity  Int      @default(0)
  minStock  Int      @default(0) // Minimum stock threshold
  updatedAt DateTime @updatedAt
  @@index([productId])
  @@unique([productId, location])
}

model Customer {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  company   String?
  email     String?
  phone     String?
  address   String?
  city      String?
  state     String?
  zipCode   String?
  country   String?
  taxId     String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
  @@index([name])
  @@index([email])
}

model Order {
  id           String      @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber  String      @unique
  type         String      // "PURCHASE" | "SALE"
  customer     Customer?   @relation(fields: [customerId], references: [id], onDelete: SetNull)
  customerId   String?     @db.ObjectId
  status       String      @default("PENDING") // PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED
  orderDate    DateTime    @default(now())
  deliveryDate DateTime?
  totalAmount  Float       @default(0)
  notes        String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  items        OrderItem[]
  @@index([customerId])
  @@index([status])
  @@index([orderDate])
}

model OrderItem {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId    String   @db.ObjectId
  product    Product  @relation(fields: [productId], references: [id], onDelete: Restrict)
  productId  String   @db.ObjectId
  quantity   Int
  unitPrice  Float
  totalPrice Float
  createdAt  DateTime @default(now())
  @@index([orderId])
  @@index([productId])
}

model StockTransaction {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId   String   @db.ObjectId
  type        String   // "IN" | "OUT" | "ADJUSTMENT"
  quantity    Int
  previousQty Int
  newQty      Int
  reason      String?  // "PURCHASE", "SALE", "RETURN", "ADJUSTMENT", etc.
  reference   String?  // Order ID or other reference
  notes       String?
  createdAt   DateTime @default(now())
  @@index([productId])
  @@index([type])
  @@index([createdAt])
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  type      String   // "LOW_STOCK", "ORDER", "SYSTEM"
  title     String
  message   String
  read      Boolean  @default(false)
  link      String?  // URL to related page
  createdAt DateTime @default(now())
  @@index([read])
  @@index([createdAt])
}


